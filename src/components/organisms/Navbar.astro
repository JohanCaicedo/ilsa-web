---
// src/components/organisms/Navbar.astro
import NavLink from "../atoms/navbar/NavLink.astro";
import NavDropdown from "../atoms/navbar/NavDropdown.astro";
import NavButton from "../atoms/navbar/NavButton.astro";

const navStructure = [
    { type: "link", text: "Inicio", href: "/" },
    {
        type: "dropdown",
        text: "Nosotros",
        href: "/nosotros",
        items: [
            {
                label: "Dirección Ejecutiva",
                href: "/nosotros/direccion-ejecutiva",
            },
            { label: "Junta Directiva", href: "/nosotros/junta-directiva" },
        ],
    },
    {
        type: "dropdown",
        text: "Opinión",
        href: "/opinion",
        // Mapping specific authors based on user request. Using generic slugs for now matching the names.
        // In a real app we might fetch this dynamically, but user provided specific list.
        items: [
            {
                label: "Boaventura de Sousa Santos",
                href: "/opinion/boaventura-de-sousa-santos",
            },
            {
                label: "Carlos Federico Mares",
                href: "/opinion/carlos-federico-mares",
            },
            {
                label: "Consuelo Quattrocchi",
                href: "/opinion/consuelo-quattrocchi",
            },
            {
                label: "Freddy Ordóñez Gómez",
                href: "/opinion/freddy-ordonez-gomez",
            },
            {
                label: "Germán Burgos Silva",
                href: "/opinion/german-burgos-silva",
            },
            {
                label: "Liliana Estupiñán Achury",
                href: "/opinion/liliana-estupinan-achury",
            },
            {
                label: "Mauricio Chamorro Rosero",
                href: "/opinion/mauricio-chamorro-rosero",
            },
        ],
    },
    {
        type: "dropdown",
        text: "Publicaciones",
        href: "/publicaciones",
        items: [
            {
                label: "Archivo Histórico",
                href: "/publicaciones/archivo-historico",
            },
            { label: "Coediciones", href: "/publicaciones/coediciones" },
            {
                label: "Derecho y Liberación",
                href: "/publicaciones/derecho-y-liberacion",
            },
            {
                label: "En Clave de Sur",
                href: "/publicaciones/en-clave-de-sur",
            },
            {
                label: "Revista El Otro Derecho",
                href: "/publicaciones/revista-el-otro-derecho",
            },
            {
                label: "Otras Publicaciones",
                href: "/publicaciones/otras-publicaciones",
            },
            {
                label: "Textos de Aquí y Ahora",
                href: "/publicaciones/textos-de-aqui-y-ahora",
            },
            {
                label: "Útiles para Conocer y Actuar",
                href: "/publicaciones/utiles-para-conocer-y-actuar",
            },
        ],
    },
];
---

<nav
    class="flex items-center border mx-4 my-4 border-white/60 bg-white/70 backdrop-blur-xl px-6 md:px-10 py-3 rounded-full text-slate-800 text-sm fixed top-0 left-0 right-0 z-50 shadow-lg shadow-slate-200/50 supports-[backdrop-filter]:bg-white/60 transition-all duration-300"
>
    <a href="/" class="shrink-0 flex items-center" aria-label="ILSA Home">
        <img
            src="https://api.ilsa.org.co/wp-content/uploads/2025/08/ILSA-Logo-2025-16.svg"
            alt="ILSA Logo"
            class="h-12 w-auto object-contain"
        />
    </a>

    <!-- Desktop Menu -->
    <div
        class="hidden md:flex items-center gap-8 ml-10 flex-1 font-medium h-10"
    >
        {
            navStructure.map((item) =>
                item.type === "link" ? (
                    <NavLink href={item.href!} text={item.text} />
                ) : (
                    <NavDropdown
                        text={item.text}
                        items={item.items!}
                        href={item.href}
                    />
                ),
            )
        }
    </div>

    <!-- Desktop Actions -->
    <div class="hidden ml-auto md:flex items-center gap-4">
        <NavButton variant="secondary" href="/actividades">
            Actividades
        </NavButton>
        <div
            class="rainbow relative z-0 bg-white/15 overflow-hidden p-[1px] flex items-center justify-center rounded-full hover:scale-105 hover:shadow-[0_0_20px_rgba(78,124,206,0.6)] transition duration-300 active:scale-100 group"
        >
            <a
                href="/donaciones"
                class="px-6 text-sm py-2 text-white rounded-full font-medium bg-gray-900/90 backdrop-blur block relative z-10 w-full text-center"
            >
                Donaciones
            </a>
        </div>
    </div>

    <!-- Mobile Toggle -->
    <button
        id="menuToggle"
        class="md:hidden text-slate-700 hover:text-[#4a7dbf] transition-colors p-3 ml-auto relative z-[60]"
        aria-label="Abrir menú"
    >
        <svg
            class="w-7 h-7"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            viewBox="0 0 24 24"
            stroke-linecap="round"
            stroke-linejoin="round"
        >
            <path d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>

    <!-- Mobile Menu Overlay -->
    <div
        id="mobileMenu"
        class="absolute hidden top-[calc(100%+1rem)] right-0 left-0 mx-4 max-h-[80vh] overflow-y-auto bg-white/98 backdrop-blur-2xl border border-white/60 rounded-3xl p-8 flex flex-col items-center gap-6 shadow-2xl shadow-slate-300/50 z-[100] animate-in fade-in slide-in-from-top-4 duration-300"
    >
        {
            navStructure.map((item) => (
                <div class="w-full text-center">
                    {item.type === "link" ? (
                        <a
                            class="block py-2 text-lg font-bold text-slate-800 hover:text-[#4a7dbf]"
                            href={item.href}
                        >
                            {item.text}
                        </a>
                    ) : (
                        <div class="flex flex-col gap-2">
                            <span class="block py-1 text-xs font-black uppercase tracking-widest text-[#4a7dbf]/60 mt-2">
                                {item.text}
                            </span>
                            {item.items?.map((sub) => (
                                <a
                                    class="block py-1 text-base text-slate-600 hover:text-[#4a7dbf]"
                                    href={sub.href}
                                >
                                    {sub.label}
                                </a>
                            ))}
                        </div>
                    )}
                </div>
            ))
        }

        <div class="w-full h-px bg-slate-100 my-2"></div>

        <div class="flex flex-col gap-3 w-full">
            <NavButton
                variant="secondary"
                href="/actividades"
                class="w-full justify-center"
            >
                Actividades
            </NavButton>
            <div
                class="rainbow w-full relative z-0 bg-white/15 overflow-hidden p-[1px] flex items-center justify-center rounded-full hover:scale-105 hover:shadow-[0_0_20px_rgba(78,124,206,0.6)] transition duration-300 active:scale-100 group"
            >
                <a
                    href="/donaciones"
                    class="w-full px-4 text-sm py-3 text-white rounded-full font-medium bg-gray-900/90 backdrop-blur block text-center relative z-10"
                >
                    Donaciones
                </a>
            </div>
        </div>
    </div>
</nav>

<script>
    document.addEventListener("astro:page-load", () => {
        const menuToggle = document.getElementById("menuToggle");
        const mobileMenu = document.getElementById("mobileMenu");

        if (menuToggle && mobileMenu) {
            menuToggle.addEventListener("click", () => {
                // Toggle logic
                if (mobileMenu.classList.contains("hidden")) {
                    mobileMenu.classList.remove("hidden");
                    mobileMenu.classList.add("flex");
                    // Prevent body scroll
                    document.body.style.overflow = "hidden";
                } else {
                    mobileMenu.classList.add("hidden");
                    mobileMenu.classList.remove("flex");
                    // Restore body scroll
                    document.body.style.overflow = "";
                }
            });

            // Close menu when clicking navigation links
            const mobileLinks = mobileMenu.querySelectorAll("a");
            mobileLinks.forEach((link) => {
                link.addEventListener("click", () => {
                    mobileMenu.classList.add("hidden");
                    mobileMenu.classList.remove("flex");
                    document.body.style.overflow = "";
                });
            });
        }
    });
</script>

<style>
    @keyframes rotate {
        100% {
            transform: rotate(1turn);
        }
    }

    .rainbow::before {
        content: "";
        position: absolute;
        z-index: -1;
        left: -50%;
        top: -50%;
        width: 200%;
        height: 200%;
        background-position: 100% 50%;
        background-repeat: no-repeat;
        filter: blur(4px);
        background-image: linear-gradient(
            90deg,
            transparent,
            #4e7cce,
            #5e3b69,
            #4e7cce,
            transparent
        );
        animation: rotate 3s linear infinite;
        background-size: 50% 50%;
    }
</style>
