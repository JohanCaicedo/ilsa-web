---
import Liquid3D from "./Liquid3D";

interface Props {
    class?: string;
    id?: string;
    intensity?: "low" | "medium" | "high";
    clipContent?: boolean;
    frosted?: boolean;
    use3D?: boolean;
}

const {
    class: className,
    id,
    intensity = "medium",
    clipContent = true,
    frosted = false,
    use3D = true,
} = Astro.props;

// Ensure unique ID for potential future use, though simplifed here
const uniqueId = id || `lg-${Math.random().toString(36).substr(2, 9)}`;
---

<div
    id={uniqueId}
    class:list={["glass-container group", className]}
    style={clipContent ? "overflow: hidden;" : "overflow: visible;"}
>
    {/* 3D WebGL Layer - Physical Refraction & Tinting */}
    {
        use3D && (
            <div class="glass-webgl-layer">
                <Liquid3D
                    client:only="react"
                    intensity={intensity}
                    frosted={frosted}
                />
            </div>
        )
    }

    {/* CSS Backdrop Blur - Base Tinting Mechanism */}
    <div class="glass-backdrop-layer"></div>

    {/* Content */}
    <div class="glass-content">
        <slot />
    </div>
</div>

<style>
    .glass-container {
        position: relative;
        isolation: isolate;
        /* Default variables if needed by children */
        --glass-border-color: rgba(255, 255, 255, 0.2);
    }

    /* 3D Layer: Z-Index 1 (Above blur, below content) */
    .glass-webgl-layer {
        position: absolute;
        inset: 0;
        z-index: 1;
        pointer-events: none;
        border-radius: inherit;
        overflow: hidden; /* Fix: Clip 3D canvas to rounded corners/pill shape */
    }

    /* CSS Layer: Z-Index 0 (Blurring the background) */
    .glass-backdrop-layer {
        position: absolute;
        inset: 0;
        z-index: 0;
        border-radius: inherit;
        pointer-events: none;
        overflow: hidden; /* Fix: Clip blur layer to rounded corners */

        /* The Core Blur Logic */
        backdrop-filter: blur(40px) saturate(180%);
        -webkit-backdrop-filter: blur(40px) saturate(180%);

        /* Milky white tint for legibility - boosted to 30% */
        background-color: rgba(255, 255, 255, 0.3);
    }

    /* Content: Z-Index 10 (Interactive) */
    .glass-content {
        position: relative;
        z-index: 10;
        height: 100%;
        width: 100%; /* Fix: Ensure content fills container so spacers work */
    }
</style>
