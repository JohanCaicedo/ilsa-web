---
import SmartImage from "../atoms/SmartImage.astro";

interface Props {
    title: string;
    author: string;
    authorImage: string; // Author's profile photo
    image: string; // Article image (fallback)
    date: string;
    uri: string;
    width?: number;
    height?: number;
    gradient?: string; // Optional gradient override
}

const {
    title,
    author,
    authorImage,
    image,
    date,
    uri,
    width = 400,
    height = 400,
    gradient,
} = Astro.props;

// Square card size: 320x320
const CARD_SIZE = 320;
---

<a
    href={uri}
    class="group relative block h-[320px] w-[320px] shrink-0 rounded-3xl shadow-lg transition-all duration-300 hover:-translate-y-2 hover:shadow-2xl focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ilsa-blue)] focus-visible:ring-offset-2 isolate overflow-hidden touch-action-manipulation"
>
    <!-- ILSA Interactive Radial Gradient Background -->
    <div
        class="interactive-gradient-card absolute inset-0 transition-all duration-75 ease-linear"
        style="
            --x: 50%;
            --y: 50%;
            --gradient-from: var(--ilsa-blue);
            --gradient-to: var(--ilsa-mujeres);
            background-image: radial-gradient(circle at var(--x) var(--y), var(--gradient-from), var(--gradient-to));
        "
    >
    </div>

    <!-- Subtle overlay for depth -->
    <div
        class="absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-black/20 opacity-60 transition-opacity duration-300 group-hover:opacity-40 pointer-events-none"
    >
    </div>

    <!-- Content Container with proper padding and spacing -->
    <div class="absolute inset-0 flex flex-col justify-between p-8 z-10">
        <!-- Top: Author Name -->
        <div class="flex items-start justify-between">
            <span
                class="text-sm font-bold tracking-wide text-white/90 uppercase transition-colors duration-200 group-hover:text-white"
            >
                {author}
            </span>
        </div>

        <!-- Middle: Article Title (centered vertically) -->
        <div class="flex-1 flex items-center">
            <h3
                class="font-sans text-2xl font-extrabold leading-tight text-white antialiased line-clamp-4 transition-all duration-200 group-hover:scale-[1.02]"
                style="text-shadow: 0 2px 12px rgba(0,0,0,0.3)"
            >
                {title}
            </h3>
        </div>

        <!-- Bottom: Date -->
        <div class="flex items-end justify-between">
            <time
                class="text-xs font-medium text-white/70 tracking-wider uppercase transition-colors duration-200 group-hover:text-white/90"
            >
                {date}
            </time>

            <!-- Read indicator -->
            <svg
                class="w-5 h-5 text-white/60 transition-all duration-300 group-hover:text-white group-hover:translate-x-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
            </svg>
        </div>
    </div>
</a>

<script>
    function setupInteractiveCardGradient() {
        const cards = document.querySelectorAll(".interactive-gradient-card");

        cards.forEach((el) => {
            const element = el as HTMLElement;
            const cardElement = element.closest("a");

            if (!cardElement) return;

            const handleMouseMove = (e: MouseEvent) => {
                const rect = cardElement.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                element.style.setProperty("--x", `${x}px`);
                element.style.setProperty("--y", `${y}px`);
            };

            cardElement.addEventListener("mousemove", handleMouseMove);
        });
    }

    // Init on load and after Astro swaps
    setupInteractiveCardGradient();
    document.addEventListener("astro:page-load", setupInteractiveCardGradient);
</script>
