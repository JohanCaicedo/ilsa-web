---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/organisms/Navbar.astro";
import HomeHero from "../components/organisms/HomeHero.astro";
import HomeNews from "../components/organisms/HomeNews.astro";
import InstagramCTA from "../components/organisms/InstagramCTA.astro";
import ColumnistSlider from "../components/organisms/ColumnistSlider.astro";
import ImageGalleryHoveredContent from "../components/organisms/ImageGalleryHoveredContent.astro";
import HomeLegalActions from "../components/organisms/HomeLegalActions.astro";
import AlliesGrid from "../components/organisms/AlliesGrid.astro";
import { heroSlidesConfig } from "../lib/hero";
import { wpQuery, MASTER_QUERY, type MasterQueryResponse } from "../lib/wp";
import { cn } from "../lib/utils";

export const prerender = true;

// Data Fetching
const data: MasterQueryResponse = await wpQuery(MASTER_QUERY);
const allPosts = data?.posts?.nodes || [];

// Segments
const latestPost = allPosts[0]; // Kept for reference but not used in Hero
const opinionPosts = allPosts
	.filter((p) => p.categories.nodes.some((c) => c.slug === "opinion"))
	.slice(0, 10);
const newsPosts = allPosts
	.filter((p) => p.categories.nodes.some((c) => c.slug === "noticias"))
	.slice(0, 3);
const legalActionsPosts = allPosts
	.filter((p) =>
		p.categories.nodes.some((c) => c.slug === "acciones-juridicas"),
	)
	.slice(0, 3);
---

<Layout
	title="ILSA - Instituto Latinoamericano para una Sociedad y un Derecho Alternativos"
	width="wide"
>
	<Navbar />

	<!-- HERO SECTION -->
	<HomeHero slides={heroSlidesConfig} class="mb-8" />

	<!-- NEWS SECTION -->
	<HomeNews posts={newsPosts} class="mb-16" />

	<!-- INSTAGRAM CTA -->
	<InstagramCTA />

	<!-- OPINION SECTION -->
	<section class="max-w-[1400px] mx-auto px-6 mb-24">
		<div class="flex items-center gap-4 mb-8">
			<div class="h-px flex-1 bg-slate-200"></div>
		</div>
		<ColumnistSlider posts={opinionPosts} />
	</section>

	<!-- MULTIMEDIA & LEGAL CONTEXT -->
	<!-- LEGAL ACTIONS SECTION -->
	<HomeLegalActions posts={legalActionsPosts} />

	<!-- MULTIMEDIA GALLERY -->
	<ImageGalleryHoveredContent />

	<!-- ALLIES SECTION -->
	<AlliesGrid />
</Layout>
